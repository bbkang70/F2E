var currentKey=null,keysDown=new Array(256);function gameTimer(){this.update=function(){}}function Info(t,i,s){this.scene=t,this.canvas=t.canvas,this.context=this.canvas.getContext("2d"),this.visible=!0,this.text=i,this.color="white",this.setPosition=function(t,i){this.x=t,this.y=i},this.hide=function(){this.visible=!1},this.show=function(){this.visible=!0},this.setText=function(t){this.text=t},this.setColor=function(t){this.color=t},this.draw=function(){ctx=this.context,ctx.save(),ctx.font=s+"px Comic Sans MS",ctx.fillStyle=this.color,ctx.fillText(this.text,this.x,this.y),ctx.restore()},this.update=function(){this.visible&&this.draw()}}function Sprite(t,i,s,e){this.scene=t,this.canvas=t.canvas,this.context=this.canvas.getContext("2d"),this.image=new Image,this.image.src=i,this.animation=!1,this.width=s,this.height=e,this.cHeight=parseInt(this.canvas.height),this.cWidth=parseInt(this.canvas.width),this.x=200,this.y=200,this.dx=10,this.dy=0,this.imgAngle=0,this.moveAngle=0,this.speed=10,this.camera=!1,this.visible=!0,this.boundAction=WRAP,this.changeImageObj=function(t){this.image=t},this.changeImage=function(t){this.image.src=t},this.setImage=function(t){this.image.src=t},this.setPosition=function(t,i){this.x=t,this.y=i},this.setX=function(t){this.x=t},this.setY=function(t){this.y=t},this.setChangeX=function(t){this.dx=t},this.setChangeY=function(t){this.dx=ndx},this.setDX=function(t){this.dx=t},this.setDY=function(t){this.dy=t},this.changeXby=function(t){this.x+=t},this.changeYby=function(t){this.y+=t},this.hide=function(){this.visible=!1},this.show=function(){this.visible=!0},this.draw=function(){ctx=this.context,ctx.save(),ctx.translate(this.x,this.y),ctx.rotate(this.imgAngle),0!=this.animation?this.animation.drawFrame(ctx):ctx.drawImage(this.image,0-this.width/2,0-this.height/2,this.width,this.height),ctx.restore()},this.update=function(){this.x+=this.dx,this.y+=this.dy,this.checkBounds(),this.visible&&this.draw()},this.setBoundAction=function(t){this.boundAction=t},this.checkBounds=function(){camX=0,camY=0,this.camera&&(camX=this.camera.cameraOffsetX,camY=this.camera.cameraOffsetY),rightBorder=this.cWidth+camX,leftBorder=camX,topBorder=camY,bottomBorder=this.cHeight+camY,offRight=!1,offLeft=!1,offTop=!1,offBottom=!1,this.x>rightBorder&&(offRight=!0),this.x<leftBorder&&(offLeft=!0),this.y>bottomBorder&&(offBottom=!0),this.y<0&&(offTop=!0),this.boundAction==WRAP?(offRight&&(this.x=leftBorder),offBottom&&(this.y=topBorder),offLeft&&(this.x=rightBorder),offTop&&(this.y=bottomBorder)):this.boundAction==BOUNCE?((offTop||offBottom)&&(this.dy*=-1,this.calcSpeedAngle(),this.imgAngle=this.moveAngle),(offLeft||offRight)&&(this.dx*=-1,this.calcSpeedAngle(),this.imgAngle=this.moveAngle)):this.boundAction==STOP?(offLeft||offRight||offTop||offBottom)&&this.setSpeed(0):this.boundAction==DIE&&(offLeft||offRight||offTop||offBottom)&&(this.hide(),this.setSpeed(0))},this.loadAnimation=function(t,i,s,e){this.animation=new Animation(this.image,t,i,s,e),this.animation.setup()},this.calcVector=function(){this.dx=this.speed*Math.cos(this.moveAngle),this.dy=this.speed*Math.sin(this.moveAngle)},this.calcSpeedAngle=function(){this.speed=Math.sqrt(this.dx*this.dx+this.dy*this.dy),this.moveAngle=Math.atan2(this.dy,this.dx)},this.setSpeed=function(t){this.speed=t,this.calcVector()},this.getSpeed=function(){return speed=Math.sqrt(this.dx*this.dx+this.dy*this.dy),speed},this.changeSpeedBy=function(t){this.speed+=t,this.calcVector()},this.setImgAngle=function(t){t-=90,this.imgAngle=t*Math.PI/180},this.getImgAngle=function(){return 180*this.imgAngle/Math.PI+90},this.changeImgAngleBy=function(t){rad=t*Math.PI/180,this.imgAngle+=rad},this.setMoveAngle=function(t){t%=360,t-=90,this.moveAngle=t*Math.PI/180,this.calcVector()},this.changeMoveAngleBy=function(t){diffRad=t*Math.PI/180,this.moveAngle+=diffRad,this.calcVector()},this.setAngle=function(t){this.setMoveAngle(t),this.setImgAngle(t)},this.changeAngleBy=function(t){this.changeMoveAngleBy(t),this.changeImgAngleBy(t)},this.turnBy=function(t){this.changeAngleBy(t)},this.addVector=function(t,i){angle=(t-=90)*Math.PI/180,newDX=i*Math.cos(angle),newDY=i*Math.sin(angle),this.dx+=newDX,this.dy+=newDY,this.calcSpeedAngle()},this.collidesWith=function(t){return collision=!1,this.visible&&t.visible&&(myLeft=this.x-this.width/2,myRight=this.x+this.width/2,myTop=this.y-this.height/2,myBottom=this.y+this.height/2,otherLeft=t.x-t.width/2,otherRight=t.x+t.width/2,otherTop=t.y-t.height/2,otherBottom=t.y+t.height/2,collision=!0,(myBottom<otherTop||myTop>otherBottom||myRight<otherLeft||myLeft>otherRight)&&(collision=!1)),collision},this.distanceTo=function(t){return diffX=this.x-t.x,diffY=this.y-t.y,dist=Math.sqrt(diffX*diffX+diffY*diffY),dist},this.angleTo=function(t){return myX=this.x+this.width/2,myY=this.y+this.height/2,otherX=t.x+t.width/2,otherY=t.y+t.height/2,diffX=myX-otherX,diffY=myY-otherY,radians=Math.atan2(diffY,diffX),degrees=180*radians/Math.PI,degrees+=90,degrees},this.isMouseDown=function(){return mx=this.scene.getMouseX(),my=this.scene.getMouseY(),sLeft=this.x-this.width/2,sRight=this.x+this.width/2,sTop=this.y-this.height/2,sBottom=this.y+this.height/2,hit=!1,mx>sLeft&&mx<sRight&&my>sTop&&my<sBottom&&(this.scene.touchable?hit=!0:this.scene.getMouseClicked()&&(hit=!0)),hit},this.isClicked=function(){return this.isMouseDown()},this.setCameraRelative=function(t){this.camera=t},this.report=function(){console.log("x: "+this.x+", y: "+this.y+", dx: "+this.dx+", dy: "+this.dy+", speed: "+this.speed+", angle: "+this.moveAngle)}}function Scene(){this.touchable="createTouch"in document,this.canvas=document.createElement("canvas"),this.canvas.style.backgroundColor="yellow",document.body.appendChild(this.canvas),this.context=this.canvas.getContext("2d"),this.clear=function(){this.context.clearRect(0,0,this.width,this.height)},this.ready=function(){localUpdate()},this.start=function(){this.initKeys(),document.onkeydown=this.updateKeys,document.onkeyup=this.clearKeys,this.intID=setInterval(localUpdate,50),document.onmousemove=this.updateMousePos,document.mouseClicked=!1,document.onmousedown=function(){this.mouseDown=!0,this.mouseClicked=!0},document.onmouseup=function(){this.mouseDown=!1,this.mouseClicked=!1}},this.stop=function(){clearInterval(this.intID)},this.updateKeys=function(t){currentKey=t.keyCode,keysDown[t.keyCode]=!0},this.clearKeys=function(t){currentKey=null,keysDown[t.keyCode]=!1},this.initKeys=function(){for(keyNum=0;keyNum<256;keyNum++)keysDown[keyNum]=!1},this.setSizePos=function(t,i,s,e){this.setSize(t,i),this.setPos(s,e)},this.setSize=function(t,i){this.width=t,this.height=i,this.canvas.width=this.width,this.canvas.height=this.height},this.setPos=function(t,i){this.left=t,this.top=i,this.canvas.style.MozTransform="translate("+t+"px, "+i+"px)",this.canvas.style.WebkitTransform="translate("+t+"px, "+i+"px)",this.canvas.style.OTransform="translate("+t+"px, "+i+"px)"},this.setBG=function(t){this.canvas.style.backgroundColor=t},this.updateMousePos=function(t){this.mouseX=t.pageX,this.mouseY=t.pageY},this.hideCursor=function(){this.canvas.style.cursor="none"},this.showCursor=function(){this.canvas.style.cursor="default"},this.getMouseX=function(){return document.mouseX-this.left},this.getMouseY=function(){return document.mouseY-this.top},this.getMouseClicked=function(){return document.mouseClicked},this.hide=function(){this.canvas.style.display="none"},this.show=function(){this.canvas.style.display="block"},this.setSize(800,600),this.setPos(10,10),this.setBG("lightgray")}var AnimTimer=function(){this.date=new Date,this.lastTime=0,this.currentTime=0,this.start=function(){this.currentTime=Date.now()},this.reset=function(){this.currentTime=Date.now()},this.getTimeElapsed=function(){return this.lastTime=this.currentTime,this.currentTime=Date.now(),0==this.lastTime?0:this.currentTime-this.lastTime}};function localUpdate(){update()}K_A=65,K_B=66,K_C=67,K_D=68,K_E=69,K_F=70,K_G=71,K_H=72,K_I=73,K_J=74,K_K=75,K_L=76,K_M=77,K_N=78,K_O=79,K_P=80,K_Q=81,K_R=82,K_S=83,K_T=84,K_U=85,K_V=86,K_W=87,K_X=88,K_Y=89,K_Z=90,K_LEFT=37,K_RIGHT=39,K_UP=38,K_DOWN=40,K_SPACE=32,K_ESC=27,K_PGUP=33,K_PGDOWN=34,K_HOME=36,K_END=35,K_0=48,K_1=49,K_2=50,K_3=51,K_4=52,K_5=53,K_6=54,K_7=55,K_8=56,K_9=57,WRAP=0,BOUNCE=1,STOP=3,DIE=4,CONTINUE=5;